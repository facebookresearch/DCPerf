- benchmark: fbgemm_embedding
  name: fbgemm_embedding_a_single
  description: Performance benchmark for Model A workload using one single representative embedding table.
  args:
    - nbit-cpu
    - '--num-embeddings={embeddings}'
    - '--bag-size={bag_size}'
    - '--embedding-dim={embedding_dim}'
    - '--batch-size={batch_size}'
    - '--num-tables={num_tables}'
    - '--weights-precision={weights_precision}'
    - '--output-dtype={output_dtype}'
    - '--copies={copies}'
    - '--iters={iters}'

  vars:
    - 'embeddings=40000000'
    - 'bag_size=2'
    - 'embedding_dim=96'
    - 'batch_size=162'
    - 'num_tables=8'
    - 'weights_precision=int4'
    - 'output_dtype=fp32'
    - 'copies=16'
    - 'iters=30000'

- benchmark: fbgemm_embedding
  name: fbgemm_embedding_a_spec
  description: Performance benchmark for Model A workload using a representative set of embedding tables with different bag sizes.
  args:
    - nbit-device-with-spec
    - '--num-embeddings-list={embeddings_list}'
    - '--bag-size-list={bag_size_list}'
    - '--embedding-dim-list={embedding_dim_list}'
    - '--batch-size={batch_size}'
    - '--weights-precision={weights_precision}'
    - '--output-dtype={output_dtype}'
    - '--cpu-copies={copies}'
    - '--iters={iters}'
    - '--use-cpu'

  vars:
    - 'embeddings_list=40000000,40000000,40000000,40000000,40000000,40000000,40000000,40000000,40000000,40000000,40000000,40000000,40000000,40000000,40000000,40000000,40000000'
    - 'bag_size_list=1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5,5'
    - 'embedding_dim_list=96,96,96,96,96,96,96,96,96,96,96,96,96,96,96,96,96'
    - 'batch_size=168'
    - 'weights_precision=int4'
    - 'output_dtype=fp32'
    - 'copies=16'
    - 'iters=20000'


- benchmark: fbgemm_embedding
  name: fbgemm_embedding_b_spec_int4
  description: Performance benchmark for Model B workload using a representative set of embedding tables with int4 precision.
  args:
    - nbit-device-with-spec
    - '--num-embeddings-list={embeddings_list}'
    - '--bag-size-list={bag_size_list}'
    - '--embedding-dim-list={embedding_dim_list}'
    - '--batch-size={batch_size}'
    - '--weights-precision={weights_precision}'
    - '--output-dtype={output_dtype}'
    - '--cpu-copies={copies}'
    - '--iters={iters}'
    - '--use-cpu'

  vars:
    - 'embeddings_list=5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,14794752,14794752,14794752,14794752,14794752,14794752,14794752,14794752,14794752,14794752,14794752,14794752,14794752,14794752,14794752,14794752,14794752,14794752,14794752,14794752,14794752,14794752,14794752,14794752,14794752,14794752,14794752,14794752,14794752,14794752,4494000,4494000,4494000,4494000,4494000,4494000,4494000,4494000,4494000,4494000,1697000,1697000,1697000,1697000,1697000,1697000,1697000,1697000,1697000,5000000,5000000,5000000,5000000,5000000,5000000,5000000,2520064,2520064,2520064,2520064,2520064,2520064,2520064,1567000,1567000,1567000,1567000,1567000,1567000,1144000,1144000,1144000,1144000,1144000,1144000,1144000,1144000,1144000,1144000'
    - 'bag_size_list=1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,5,5,3,3,4'
    - 'embedding_dim_list=64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64'
    - 'batch_size=190'
    - 'weights_precision=int4'
    - 'output_dtype=fp32'
    - 'copies=16'
    - 'iters=4000'


- benchmark: fbgemm_embedding
  name: fbgemm_embedding_b_spec_int8
  description: Performance benchmark for Model B workload using a representative set of embedding tables with int8 precision.
  args:
    - nbit-device-with-spec
    - '--num-embeddings-list={embeddings_list}'
    - '--bag-size-list={bag_size_list}'
    - '--embedding-dim-list={embedding_dim_list}'
    - '--batch-size={batch_size}'
    - '--weights-precision={weights_precision}'
    - '--output-dtype={output_dtype}'
    - '--cpu-copies={copies}'
    - '--iters={iters}'
    - '--use-cpu'

  vars:
    - 'embeddings_list=100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,872448,872448,872448,872448,872448,872448,872448,872448,872448,872448,872448,872448,872448,872448,872448,872448,872448,619520,619520,619520,619520,529408,529408,529408,529408,619520,619520,619520,872448,872448,872448,529408,529408,529408,529408,529408,529408,872448,872448,100000,100000,619520,619520,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,619520,100000,100000,100000,100000,100000,619520,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,10000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000'
    - 'bag_size_list=1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,5,5,5,5,1,1,1,1,2,2,2,2,2,2,2,3,3,3,4,4,4,5,5,5,4,4,1,1,3,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5,1,1,1,1,1,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1'
    - 'embedding_dim_list=64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64'
    - 'batch_size=188'
    - 'weights_precision=int8'
    - 'output_dtype=fp32'
    - 'copies=16'
    - 'iters=4000'


- benchmark: rebatch
  name: rebatch_a
  description: rebatch benchmark for Model A.
  args:
    - '--threads={threads}'
    - '--duration={duration}'
    - '--size-dist={size_dist}'
    - '--tensors={tensors_num}'
    - '--prefetch={prefetch}'
    - '--output-tensor-size={output_tensor_size}'
    - '--memory-pool-size={memory_pool_size}'

  vars:
    - 'threads=1'
    - 'duration=300'
    - 'size_dist=benchmarks/rebatch/model_a.dist'
    - 'tensors_num=54'
    - 'prefetch=0'
    - 'output_tensor_size=5023008'
    - 'memory_pool_size=4'

- benchmark: rebatch
  name: rebatch_b
  description: rebatch benchmark for Model B.
  args:
    - '--threads={threads}'
    - '--duration={duration}'
    - '--size-dist={size_dist}'
    - '--tensors={tensors_num}'
    - '--prefetch={prefetch}'
    - '--output-tensor-size={output_tensor_size}'
    - '--memory-pool-size={memory_pool_size}'

  vars:
    - 'threads=1'
    - 'duration=300'
    - 'size_dist=benchmarks/rebatch/model_b.dist'
    - 'tensors_num=53'
    - 'prefetch=0'
    - 'output_tensor_size=2421002'
    - 'memory_pool_size=4'
